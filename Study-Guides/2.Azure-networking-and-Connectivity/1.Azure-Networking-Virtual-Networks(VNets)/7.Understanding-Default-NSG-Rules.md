# Understanding Default NSG Rules:

When you create a Network Security Group (NSG) in Azure, it comes pre-populated with a set of **default security rules**. These rules cannot be deleted or modified directly, but they can be **overridden** by creating your own custom rules with a **higher priority** (lower numerical value).

Understanding these default rules is essential because they define the baseline behavior of your network traffic if you don't create any custom rules.

---

## The Default NSG Rules ‚öôÔ∏è

Every NSG, whether it's associated with a subnet or a NIC, contains the following default rules:

### Inbound Default Rules:

| Priority | Name                        | Source             | Source Ports | Destination        | Destination Ports | Protocol | Action | Description                                                                                              |
| :------- | :-------------------------- | :----------------- | :----------- | :----------------- | :---------------- | :------- | :----- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **65000** | `AllowVnetInBound`          | `VirtualNetwork`   | `*`          | `VirtualNetwork`   | `*`               | `Any`    | `Allow` | **Allows all inbound traffic from within the same Virtual Network (VNet) or peered VNets.** This means VMs in different subnets of the same VNet, or VMs in peered VNets, can communicate with each other by default. This also includes traffic from connected on-premises networks. |
| **65001** | `AllowAzureLoadBalancerInBound` | `AzureLoadBalancer` | `*`          | `VirtualNetwork`   | `*`               | `Any`    | `Allow` | **Allows inbound traffic from the Azure Load Balancer health probes.** This is crucial for VMs that are part of a load-balanced set, allowing the load balancer to determine their health status.                                                             |
| **65500** | `DenyAllInbound`            | `Any`              | `*`          | `Any`              | `*`               | `Any`    | `Deny` | **Denies all other inbound traffic.** This is the ultimate "catch-all" deny rule. If an inbound connection does not match a higher-priority `Allow` rule, it will be blocked by this rule. This is why you need to create explicit allow rules for external access (e.g., RDP, SSH, HTTP from the Internet). |

---

### Outbound Default Rules:

| Priority | Name                        | Source             | Source Ports | Destination        | Destination Ports | Protocol | Action | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| :------- | :-------------------------- | :----------- | :----------------- | :----------- | :----------------- | :------- | :----- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **65000** | `AllowVnetOutBound`         | `VirtualNetwork`   | `*`          | `VirtualNetwork`   | `*`               | `Any`    | `Allow` | **Allows all outbound traffic to destinations within the same Virtual Network (VNet) or peered VNets.** Similar to `AllowVnetInBound`, this ensures resources within your VNet can communicate with each other. This also includes traffic to connected on-premises networks.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **65001** | `AllowInternetOutBound`     | `Any`              | `*`          | `Internet`         | `*`               | `Any`    | `Allow` | **Allows all outbound traffic to the Internet.** This is an important rule to be aware of. By default, your Azure VMs can initiate outbound connections to any destination on the public internet. While convenient for updates and software installations, it's often a security best practice to restrict this outbound access to only what's necessary, which would require creating higher-priority `Deny` rules for specific destinations/ports.                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **65500** | `DenyAllOutbound`           | `Any`              | `*`          | `Any`              | `*`               | `Any`    | `Deny` | **Denies all other outbound traffic.** This is the ultimate "catch-all" deny rule for outbound connections. Any outbound traffic not matched by a higher-priority `Allow` rule will be blocked here. If you override `AllowInternetOutBound` with a `Deny` rule for the internet, this rule effectively becomes the final blocker for any other destinations unless you explicitly allow them. |

---

## Key Takeaways from Default Rules üí°

* **Lowest Priority**: All default rules have high priority numbers (65000, 65001, 65500), meaning they have the **lowest priority** in the NSG. This is by design, ensuring that any custom rules you create (which typically have priorities between 100 and 4096) will always be evaluated *before* the default rules.
* **VNet Communication is Allowed by Default**: The `AllowVnetInBound` and `AllowVnetOutBound` rules ensure that resources within your VNet (and peered VNets) can communicate freely with each other by default. If you need to restrict communication *between subnets* within the same VNet, you *must* create higher-priority `Deny` rules on the respective subnet NSGs.
* **Outbound Internet Access is Allowed by Default**: The `AllowInternetOutBound` rule means that unless you create a higher-priority `Deny` rule, your VMs can initiate connections to anywhere on the internet. For production environments, it's common to override this with more restrictive outbound rules.
* **Implicit Deny**: The `DenyAllInbound` and `DenyAllOutbound` rules act as **implicit deny** rules. They ensure that if traffic doesn't explicitly match an `Allow` rule (either custom or default with higher priority), it will be blocked. This is a fundamental security principle: "what is not explicitly allowed is implicitly denied."
* **Cannot Be Deleted**: You cannot delete these default rules. You can only override their behavior by creating custom rules with lower priority numbers (higher actual priority).

Understanding these default rules is crucial for troubleshooting network connectivity issues and for designing a robust and secure network in Azure. 

When planning your custom NSG rules, always consider how they will interact with and potentially override these foundational default behaviors.