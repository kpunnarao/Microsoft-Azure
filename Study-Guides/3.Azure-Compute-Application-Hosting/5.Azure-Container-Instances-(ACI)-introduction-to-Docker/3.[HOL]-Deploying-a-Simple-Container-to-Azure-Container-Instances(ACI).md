# Lab: Deploying a Simple Container to Azure Container Instances (ACI) üê≥üöÄ

This will be a hands-on lab where we'll take a pre-built Docker image and deploy it directly to ACI using different methods.

But first, I need to fetch some up-to-date information to ensure the lab instructions are current and accurate.

The search results confirm the standard methods for deploying to ACI (Portal, CLI, PowerShell) and provide examples for each. 

They also highlight that for ACI, a public IP address is assigned by default for internet-facing containers, and logging is readily available.

This lab will guide you through deploying a pre-built Docker image to Azure Container Instances (ACI) using different methods. 

You'll learn how to quickly get a containerized application running without managing any underlying virtual machines.

Let's dive into the lab\!

## Lab Scenario üè∞

You need to quickly deploy a simple web application packaged as a Docker container. 

Azure Container Instances (ACI) is the perfect solution for this on-demand, serverless container execution.

You will deploy a standard "hello-world" web server image and access it publicly.

**Resources you'll be creating:**

  * **New Resource Group**: `rg-aci-lab`
  * **New Container Instance**: `mycontainerinstance-yourname`

**Container Image we'll use**: `mcr.microsoft.com/azuredocs/aci-helloworld:latest`

  * This is a public Microsoft image of a small web app written in Node.js that serves a static HTML page. It's perfect for a quick test.

-----

## Part 1: Prerequisites

Before you begin, ensure you have:

  * An active Azure Subscription.
  * Access to the Azure Portal ([portal.azure.com](https://portal.azure.com)).
  * **For Azure CLI/PowerShell methods**: Azure CLI and/or Azure PowerShell installed and configured locally, or access to Azure Cloud Shell (recommended for simplicity).
      * If using Azure Cloud Shell, ensure you select a Bash or PowerShell environment.

-----

## Part 2: Create a Resource Group

All Azure resources must reside within a resource group.

### Method 1: Azure Portal üåê

1.  **Search for "Resource groups"** in the Azure Portal and click **"+ Create"**.
2.  **Basics tab**:
      * **Subscription**: Your subscription.
      * **Resource group name**: `rg-aci-lab`
      * **Region**: `East US` (or a region close to you).
3.  Click **"Review + create"** then **"Create"**.

### Method 2: Azure CLI üñ•Ô∏è

```bash
resourceGroup="rg-aci-lab"
location="eastus" # Choose a region close to you

az group create \
  --name $resourceGroup \
  --location $location
```

### Method 3: Azure PowerShell üíª

```powershell
$resourceGroup = "rg-aci-lab"
$location = "EastUS" # Choose a region close to you

New-AzResourceGroup -Name $resourceGroup -Location $location
```

-----

## Part 3: Deploy a Simple Container to Azure Container Instances (ACI)

Now, let's deploy the `aci-helloworld` container. We'll specify a DNS name label to make it publicly accessible via a fully qualified domain name (FQDN).

**Important**: The DNS name label needs to be **globally unique** within the Azure region. Use a unique identifier, like your initials and a random number (e.g., `aci-helloworld-xyz123`).

### Method 1: Azure Portal üåê

1.  **Search for "Container Instances"** in the Azure Portal and click **"+ Create"**.
2.  **Basics tab**:
      * **Subscription**: Your subscription.
      * **Resource group**: Select `rg-aci-lab`.
      * **Container name**: `mycontainerinstance-yourname` (e.g., `mycontainerinstance-johnsmith`).
      * **Region**: `East US` (or the same as your resource group).
      * **Image source**: Select `Quickstart images`.
      * **Container image**: `mcr.microsoft.com/azuredocs/aci-helloworld:latest (Linux)`
      * **OS type**: `Linux` (pre-selected for this image).
      * **Size**: Leave as default (1 vCPU, 1.5 GB memory - this is sufficient).
3.  **Networking tab**:
      * **DNS name label**: Enter a **unique** name here, e.g., `aci-demo-yourname-d18`. If it's not unique, you'll get an error later.
      * **Ports**: `80` (default for HTTP web apps).
      * **Protocol**: `TCP` (default).
      * Leave other settings as default.
4.  **Advanced tab**: Leave as default.
5.  **Tags tab**: (Optional) Add tags like `Environment: Lab`.
6.  Click **"Review + create"**.
7.  Once validation passes, click **"Create"**.
8.  Wait for the deployment to complete (this usually takes less than a minute).

### Method 2: Azure CLI üñ•Ô∏è

1.  **Set Variables**:
    ```bash
    resourceGroup="rg-aci-lab"
    location="eastus"
    containerName="mycontainerinstance-yourname" # e.g., mycontainerinstance-johnsmith
    dnsNameLabel="aci-demo-yourname-d18" # Must be globally unique!
    image="mcr.microsoft.com/azuredocs/aci-helloworld:latest"
    ```
2.  **Deploy the Container Instance**:
    ```bash
    az container create \
      --resource-group $resourceGroup \
      --name $containerName \
      --image $image \
      --dns-name-label $dnsNameLabel \
      --ports 80 \
      --os-type Linux \
      --cpu 1 \
      --memory 1.5
    ```
3.  Wait for the command to complete. It will output JSON indicating the deployment status.

### Method 3: Azure PowerShell üíª

1.  **Set Variables**:
    ```powershell
    $resourceGroup = "rg-aci-lab"
    $location = "EastUS"
    $containerName = "mycontainerinstance-yourname" # e.g., mycontainerinstance-johnsmith
    $dnsNameLabel = "aci-demo-yourname-d18" # Must be globally unique!
    $image = "mcr.microsoft.com/azuredocs/aci-helloworld:latest"
    ```
2.  **Define Port Object**:
    ```powershell
    $port = New-AzContainerInstancePortObject -Port 80 -Protocol TCP
    ```
3.  **Define Container Instance Object**:
    ```powershell
    $container = New-AzContainerInstanceObject -Name $containerName -Image $image -Port @($port)
    ```
4.  **Deploy the Container Group**:
    ```powershell
    New-AzContainerGroup -ResourceGroupName $resourceGroup `
      -Name $containerName `
      -Location $location `
      -Container $container `
      -OsType Linux `
      -IPAddressDnsNameLabel $dnsNameLabel `
      -IpAddressType Public `
      -IPAddressPort @($port) `
      -Cpu 1 `
      -MemoryInGB 1.5
    ```
5.  Wait for the command to complete.

-----

## Part 4: Access and Verify the Deployed Container

Once the deployment shows "Succeeded" in the Azure Portal or the command line returns a successful response:

1.  **Get the FQDN (Fully Qualified Domain Name)**:
      * **Azure Portal**: Navigate to your Container Instance (`mycontainerinstance-yourname`) in the `rg-aci-lab` resource group. On the **Overview** blade, look for the **FQDN** field. It will look something like `aci-demo-yourname-d18.eastus.azurecontainer.io`.
      * **Azure CLI**:
        ```bash
        az container show \
          --resource-group $resourceGroup \
          --name $containerName \
          --query ipAddress.fqdn \
          --output tsv
        ```
      * **Azure PowerShell**:
        ```powershell
        (Get-AzContainerGroup -ResourceGroupName $resourceGroup -Name $containerName).IpAddress.Fqdn
        ```
2.  **Browse to the FQDN**: Open a web browser and navigate to the FQDN you obtained.
3.  You should see the "Welcome to Azure Container Instances\!" page, confirming your container is running and accessible.

## Part 5: View Container Logs

Viewing logs is crucial for understanding what's happening inside your container.

1.  **Azure Portal**:
      * Navigate to your Container Instance (`mycontainerinstance-yourname`).
      * In the left menu, under **"Monitoring"**, select **"Logs"**.
      * You should see the container's standard output, including the HTTP GET requests generated when you accessed the application in your browser.
2.  **Azure CLI**:
    ```bash
    az container logs \
      --resource-group $resourceGroup \
      --name $containerName
    ```
      * You will see the logs printed in your terminal.
3.  **Azure PowerShell**:
    ```powershell
    Get-AzContainerInstanceLog -ResourceGroupName $resourceGroup -Name $containerName
    ```
      * The logs will be displayed in your PowerShell console.

-----

## Part 6: Cleaning Up Resources (Highly Recommended)

To avoid incurring ongoing costs, always delete resources you no longer need. Deleting the resource group will remove the Container Instance and all associated components.

### Method 1: Azure Portal üåê

1.  **Navigate to Resource Groups**: In the Azure Portal, go to **"Resource groups"**.
2.  Find and click on your resource group: **`rg-aci-lab`**.
3.  On the resource group's Overview blade, click **"Delete resource group"**.
4.  Type `rg-aci-lab` to confirm, then click **"Delete"**.

### Method 2: Azure CLI üñ•Ô∏è

```bash
az group delete --name rg-aci-lab --no-wait --yes
echo "Resource group 'rg-aci-lab' deletion initiated."
```

### Method 3: Azure PowerShell üíª

```powershell
Remove-AzResourceGroup -Name "rg-aci-lab" -Force -AsJob
Write-Host "Resource group 'rg-aci-lab' deletion initiated."
```

-----

You have successfully deployed a container to Azure Container Instances\! This demonstrates the speed and simplicity of ACI for running containerized workloads on-demand.