# Day Azure File Shares (SMB) ðŸ’¾

## Introduction

While Azure Blob Storage is excellent for unstructured object data, many traditional applications and on-premises environments rely heavily on **file shares** accessible via standard network protocols. 

This is where **Azure Files** comes in.

### What are Azure File Shares?

**Azure Files** offers fully managed file shares in the cloud that are accessible via industry-standard protocols:

1.  **Server Message Block (SMB)**: This is the protocol primarily used by Windows, macOS, and some Linux distributions for network file sharing.
2.  **Network File System (NFS)**: This protocol is commonly used by Linux and UNIX-based systems. (We will focus on SMB in this section, as it's typically the "Azure File Shares (SMB)" most users refer to).
3.  **Azure Files REST API**: For programmatic access.

Azure file shares can be mounted concurrently by cloud deployments (e.g., Azure VMs) or on-premises deployments, making them a powerful solution for hybrid cloud scenarios.

### Key Characteristics and Benefits:

* **Fully Managed**: Microsoft handles all the underlying hardware, OS patching, and maintenance of the file share infrastructure. You don't need to manage a file server VM.
* **Standard Protocols**: Because it uses SMB (and NFS), applications that expect a file share can "lift and shift" to Azure with minimal or no code changes. Users can interact with it just like a traditional network drive.
* **Shared Access**: Multiple VMs or even on-premises machines can mount and access the same file share simultaneously.
* **Hybrid Capabilities with Azure File Sync**: Azure File Sync is a separate service that can cache Azure file shares on on-premises Windows Servers. This combines the benefits of centralized cloud storage with the performance of local access, and it can tier infrequently used files to the cloud.
* **Durability and Availability**: Built on Azure Storage, file shares inherit the same high durability and availability features (LRS, ZRS, GRS, GZRS, etc. â€“ though not all redundancy options are available for all file share types or protocols, e.g., Premium File shares only support LRS/ZRS).
* **Security**: Data is encrypted at rest (using Storage Service Encryption) and in transit (SMB 3.x with encryption is required by default). Integration with Azure Active Directory Domain Services (Azure AD DS) or on-premises Active Directory (AD DS) allows for identity-based access control using familiar NTFS permissions.
* **Cost-Effective**: Pay-as-you-go model. Different performance tiers (Standard/Premium) allow you to optimize for cost or performance.

### Use Cases for Azure File Shares (SMB):

Azure File Shares are ideal for scenarios where you need a shared network drive or a file system accessible across multiple machines or applications.

1.  **Replace or Supplement On-Premises File Servers/NAS**:
    * Migrate existing file servers to the cloud, reducing on-premises infrastructure costs and management overhead.
    * Provide centralized storage for user home directories or team shares that can be accessed from anywhere.
2.  **"Lift and Shift" Applications**:
    * Many legacy applications are designed to store data on a local file system or a network share. Azure Files allows you to migrate these applications to Azure VMs without re-architecting their storage layer.
    * This is common for line-of-business applications, content management systems, or custom applications that expect standard file access.
3.  **Shared Application Configuration and Diagnostics**:
    * Centralize configuration files that multiple instances of a distributed application need to access.
    * Provide a common location for cloud applications to write logs, metrics, or crash dumps, making it easy for developers to access diagnostic data by mounting the share.
4.  **Development/Test/Debug Scenarios**:
    * Create a central repository for tools, utilities, or scripts that multiple developers or administrators need to access from their VMs. No need to copy tools to each VM.
5.  **Persistent Storage for Containers**:
    * Provide persistent volumes for stateful containers running in Azure Kubernetes Service (AKS) or Azure Container Instances (ACI), allowing containers to access shared data even if they are restarted or moved to a different host.
6.  **Disaster Recovery**:
    * Use Azure File Sync to replicate on-premises file shares to Azure for cloud-based disaster recovery.

### Standard vs. Premium File Shares:

Just like with blobs, Azure File Shares come in different performance tiers, residing within specific Storage Account types:

* **Standard File Shares**:
    * Part of **General-Purpose v2 (GPv2) storage accounts**.
    * Utilizes **HDD-based** storage.
    * Offers `Transaction Optimized`, `Hot`, and `Cool` access tiers (different from blob tiers, specific to files) for cost optimization based on usage patterns.
    * Suitable for general-purpose file sharing, development/test, and archival scenarios where consistent ultra-low latency is not critical.
    * Supports LRS, ZRS, GRS, GZRS redundancy options.

* **Premium File Shares**:
    * Part of dedicated **FileStorage storage accounts**.
    * Utilizes **SSD-based** storage.
    * Offers **consistent high performance and low latency** (single-digit milliseconds for most I/O operations).
    * Suitable for I/O-intensive workloads like databases, VDI (Virtual Desktop Infrastructure) user profiles, or high-performance computing scenarios.
    * Only supports LRS and ZRS redundancy.

### Accessing Azure File Shares (SMB Protocol):

To use an Azure file share, you typically "mount" it to a drive letter on a Windows machine or a mount point on Linux/macOS. This requires:

1.  **Opening Port 445**: The SMB protocol uses TCP port 445. Ensure your network, firewalls (both client-side and Azure Network Security Groups/firewalls), and ISP allow outbound traffic on this port.
2.  **Authentication**:
    * **Storage Account Key**: This is the simplest but least secure method, primarily for administrative access or quick testing. The storage account key grants full control over *all* data in the entire storage account.
    * **Identity-Based Authentication (Recommended for Production)**:
        * **Azure Active Directory Domain Services (Azure AD DS)**: Allows Azure VMs joined to Azure AD DS to authenticate to file shares using their domain credentials.
        * **On-premises Active Directory Domain Services (AD DS)**: Allows on-premises machines joined to an AD domain to authenticate to Azure file shares.
        * **Microsoft Entra ID (Azure AD) Kerberos for hybrid identities**: A newer option that allows Windows clients joined to an on-premises AD to access Azure file shares using hybrid user identities.
    * With identity-based authentication, you can assign granular NTFS permissions directly on files and folders within the share, just like a traditional file server.

Azure File Shares fill a crucial gap in cloud storage, enabling seamless migration and operation of applications that depend on traditional file system semantics and network file shares.