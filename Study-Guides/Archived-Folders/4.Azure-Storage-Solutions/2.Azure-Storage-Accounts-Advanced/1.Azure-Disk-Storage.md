# Azure Disk Storage (Persistent Storage for VMs) ðŸ’¾

## Introduction

**Azure Disks are a fundamentally important storage service** within Azure, particularly when discussing Virtual Machines.

**Azure Disks are essentially the virtual hard drives (VHDs) that provide persistent, block-level storage for Azure Virtual Machines (VMs).** They are crucial for both the operating system (OS) and any data that needs to persist beyond the lifecycle of the VM itself.

Beyond the shared, networked storage services like Blobs, Files, Queues, and Tables, Azure also provides **Disk Storage**, which is dedicated, block-level storage primarily used by Azure Virtual Machines (VMs). Think of them as the virtual hard drives (VHDs) for your cloud servers.

### What is Azure Disk Storage?

Azure Disk Storage provides highly durable, high-performance block storage for Azure Virtual Machines. 

These disks are designed for scenarios where data needs to be persistently stored and directly attached to a single VM, functioning much like physical hard drives in a server.

### Key Concepts:

* **Managed Disks (Recommended)**:
    * **Abstraction**: Azure manages the storage accounts associated with the disks for you. You no longer need to worry about storage account limits, regional availability sets, or even the underlying storage account type (it handles it all).
    * **Scalability**: Easily create and manage thousands of disks for your VMs.
    * **Durability**: Disks are automatically replicated three times within an Availability Zone (for ZRS enabled regions) or a fault domain (for LRS) to ensure high durability.
    * **Availability**: Automatically placed in different storage stamps to isolate them from single points of failure.
    * **Snapshot/Backup**: Easy to create snapshots for point-in-time recovery and integrate with Azure Backup.
    * **Cost**: Simplified billing based on the disk's size and performance tier.
    * **Default and Preferred**: This is the recommended and default choice for virtually all new VM deployments.

* **Unmanaged Disks (Legacy)**:
    * **Direct Control**: You manually manage the storage accounts where your VHDs are stored.
    * **Complexity**: Requires you to monitor storage account limits (IOPS, capacity) and plan for fault domains/update domains.
    * **Not Recommended**: Generally not recommended for new deployments due to the operational overhead and the superior features of Managed Disks.

### Types and Performance Tiers of Managed Disks:

Azure offers several types of Managed Disks, each optimized for different performance and cost requirements:

1.  **Ultra Disks**:
    * **Underlying Hardware**: Highly performant, extremely low-latency SSDs.
    * **Key Feature**: Unique ability to **dynamically adjust IOPS and throughput** independently, without needing to detach or restart the VM. You can fine-tune performance on the fly.
    * **Performance**: Highest IOPS and throughput, lowest latency (sub-millisecond latency).
    * **Use Cases**: Most demanding, I/O-intensive workloads like top-tier databases (e.g., SAP HANA, SQL Server, Oracle), transaction-heavy OLTP systems, and other mission-critical applications that require extreme performance.
    * **Cost**: Highest cost.

2.  **Premium SSDs**:
    * **Underlying Hardware**: High-performance SSDs.
    * **Key Feature**: Offers consistently high IOPS and throughput with low latency. Performance tiers are defined by disk size (e.g., P10, P20, P30), and performance scales with disk size.
    * **Performance**: Excellent for production workloads.
    * **Use Cases**: Production databases, enterprise applications, data warehouses, development/test environments requiring good performance, high-traffic web servers.
    * **Cost**: Higher than Standard SSDs, lower than Ultra Disks.

3.  **Standard SSDs**:
    * **Underlying Hardware**: SSDs, but with lower performance characteristics than Premium SSDs.
    * **Key Feature**: Offers more consistent performance and lower latency compared to Standard HDDs, but at a lower cost than Premium SSDs.
    * **Performance**: Good for web servers, lightly used enterprise applications, and dev/test environments.
    * **Use Cases**: Web servers, smaller databases, dev/test workloads, infrequently accessed data, non-critical production applications.
    * **Cost**: Lower than Premium SSDs, higher than Standard HDDs.

4.  **Standard HDDs**:
    * **Underlying Hardware**: Traditional spinning Hard Disk Drives.
    * **Key Feature**: Most cost-effective disk option.
    * **Performance**: Offers the lowest IOPS and throughput, with higher latency. Performance can be inconsistent due to the nature of HDDs.
    * **Use Cases**: Infrequently accessed data, development/test scenarios where performance is not critical, archival, or backup disks for non-critical data.
    * **Cost**: Lowest cost.

### OS Disks vs. Data Disks:

* **OS Disk**: Every Azure VM has one operating system (OS) disk. This disk contains the operating system that the VM runs on. It's typically a `Premium SSD` or `Standard SSD` for performance reasons, depending on the VM size and tier.
* **Data Disks**: You can attach one or more data disks to an Azure VM for persistent data storage. These are used for application data, databases, user profiles, or any other data that needs to be saved. You can mix and match different disk types and sizes based on your application's specific I/O requirements for each data disk.

### Durability and Availability for Disks:

Azure Managed Disks provide a durability of **99.999%** over a year. They are highly available through various mechanisms:

* **LRS (Locally Redundant Storage)**: For Managed Disks, data is replicated three times within a single data center (fault domain/update domain).
* **ZRS (Zone-Redundant Storage)**: For Managed Disks in regions that support Availability Zones, you can choose ZRS, which replicates your disk data across three Availability Zones in the region. This protects your data even if one entire data center (Availability Zone) goes down. This is particularly important for shared disks or for high-availability solutions spanning zones.
* **Cross-Region Replication**: For disaster recovery across regions, you typically rely on VM-level replication services like Azure Site Recovery or application-level replication, as disks themselves are not directly geo-replicated like Blob/File Storage accounts can be (GRS/RA-GRS).

### Snapshot and Backup:

* **Snapshots**: A point-in-time read-only copy of a disk. Snapshots are incremental, storing only the changes since the last snapshot. They are crucial for creating backups or for quickly spinning up new VMs from a known state.
* **Azure Backup**: Can be used to manage backups of your entire VMs, including their OS and data disks, ensuring long-term retention and easy recovery.

### When to Use Azure Disks vs. Azure Files/Blobs:

* **Azure Disks**: When you need **persistent, block-level storage directly attached to a *single* VM**. Ideal for OS volumes, databases (where the DB engine runs on the VM), and applications that require low-latency, random access I/O.
* **Azure Files**: When you need a **shared network file system (SMB/NFS)** accessible concurrently by *multiple* VMs or on-premises machines. Ideal for "lift and shift" apps, shared configurations, and user directories.
* **Azure Blobs**: When you need **massively scalable object storage for unstructured data**. Ideal for images, videos, logs, backups, and large analytical datasets that are accessed via HTTP/HTTPS.

Given its fundamental nature for VMs, it's definitely an oversight not to have a dedicated section. Thank you for catching that! We should certainly consider a lab for this as well.

---