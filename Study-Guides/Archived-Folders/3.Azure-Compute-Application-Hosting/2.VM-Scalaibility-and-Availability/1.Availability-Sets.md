# Availability Sets (Fault Domains, Update Domains) üõ°Ô∏è

Let's dive into **Azure Availability Sets**, which are a foundational concept for building highly available applications in Azure. 

They're all about protecting your VMs from failures within a single Azure datacenter.

Availability Sets are a crucial Azure feature designed to ensure the high availability of your applications. 

When you place two or more Virtual Machines (VMs) in an Availability Set, Azure automatically distributes them across different physical hardware in the datacenter, protecting them from both planned maintenance events and unplanned hardware failures.

### The Problem Availability Sets Solve üìâ

Imagine you have a critical application running on a single VM. If the physical server hosting that VM experiences a hardware failure (e.g., power supply failure, network card issue) or requires planned maintenance (e.g., host OS update), your application goes down. 

Availability Sets mitigate this by ensuring your VMs are not single points of failure.

### What is an Availability Set? ü§î

An **Availability Set** is a logical grouping of VMs that allows Azure to understand how your application is built to provide for redundancy and availability. Azure guarantees that the VMs within an Availability Set are spread across different **Fault Domains** and **Update Domains** within a single Azure datacenter. This distribution helps achieve a **99.95% Azure SLA** for VMs within an Availability Set.

You must assign a VM to an Availability Set at the time of its creation; you cannot add an existing VM to an Availability Set afterward.

\<hr\>

### Fault Domains (FDs) ‚ö°

**Fault Domains** represent a group of hardware components that share a single point of failure within an Azure datacenter. Think of them as physical infrastructure segments.

  * **Definition**: A fault domain is essentially a logical grouping of VMs that share a **common power source, network switch, and physical server rack**.
  * **Protection**: If a power outage or network failure affects a specific rack or a piece of hardware within that rack, only the VMs in that fault domain are impacted. VMs in other fault domains remain unaffected.
  * **Distribution**: Azure automatically spreads VMs across a minimum of **3 Fault Domains** (you can sometimes configure this number, but 3 is the standard). This means if you have 3 VMs in an Availability Set, each VM will ideally be in a different fault domain. If you add a 4th VM, it will be placed in one of the existing 3 fault domains.
  * **Analogy**: Imagine a datacenter with multiple server racks. Each rack, with its own power strip and network connection, could be considered a fault domain. If one rack loses power, only the servers in that rack go down.

\<hr\>

### Update Domains (UDs) üîÑ

**Update Domains** are a logical grouping of VMs and underlying physical hardware that can be rebooted at the same time during planned maintenance by Azure.

  * **Definition**: An update domain is a logical grouping that ensures that not all VMs in your application are updated or rebooted simultaneously during planned maintenance events.
  * **Protection**: During an Azure platform update, only one update domain is updated at a time. The VMs within that update domain are taken offline, updated, and brought back online. Azure then waits a specified period (typically 30 minutes) for the VMs to recover before moving to the next update domain. This rolling update process minimizes downtime for your overall application.
  * **Distribution**: Azure distributes VMs across a default of **5 Update Domains** within an Availability Set (though you can configure this from 2 to 20). If you have 5 VMs, each goes into a different update domain. If you have 6 VMs, one update domain will host two VMs.
  * **Analogy**: Think of it like a train with multiple carriages. When maintenance is needed, only one carriage is taken to the workshop at a time, while the rest of the train continues to operate.

\<hr\>

### How Availability Sets Work Together ü§ù

When you create VMs within an Availability Set:

1.  Azure automatically assigns each new VM to a different **Fault Domain** until all available fault domains are used, then it cycles back.
2.  Azure also automatically assigns each new VM to a different **Update Domain** until all available update domains are used, then it cycles back.

This dual distribution ensures that:

  * If there's an unexpected hardware failure (e.g., power loss to a server rack), only VMs in the affected **Fault Domain** are impacted, while other instances of your application continue running in different fault domains.
  * If Azure performs planned maintenance that requires a reboot, only VMs in one **Update Domain** are affected at a time, allowing other instances of your application to remain online.

### Use Cases and Best Practices üéØ

  * **Stateless Workloads**: Availability Sets are ideal for redundant, stateless applications (like web servers) where you can run multiple identical instances.
  * **Load Balancers**: For best results, combine Availability Sets with an **Azure Load Balancer**. The Load Balancer distributes incoming traffic across the healthy VMs in your Availability Set, ensuring continuous service even if one VM is offline.
  * **At Least Two VMs**: To benefit from the SLA, you need to deploy **at least two VMs** within the same Availability Set.
  * **Cost**: There is no additional cost for the Availability Set itself; you only pay for the VMs and associated resources.

While Availability Sets provide excellent protection within a single datacenter, they do not protect against datacenter-wide or region-wide disasters. 

For that, you'd look to **Availability Zones**, which we'll cover next.