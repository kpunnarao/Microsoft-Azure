## Creating DNS Zones and Records (A, CNAME, MX, TXT) üìù

Creating DNS zones and records in Azure DNS is a straightforward process, whether you're managing a public-facing domain or a private internal one. 

This guide will walk you through the steps to set up a DNS zone and various common record types using the Azure portal, Azure PowerShell, and Azure CLI.

-----

### Core Concepts Refresher:

  * **DNS Zone**: A container for all the DNS records for a specific domain name (e.g., `example.com`).
  * **DNS Record**: An individual mapping within a DNS zone. Each record type serves a specific purpose.

-----

## Example Scenario: Setting Up `mydomain.com` üåç

We'll use `mydomain.com` as our example domain and create various records within it.

  * **Resource Group**: `rg-dns-demo`
  * **Location**: `eastus` (for the resource group, DNS zones are global)
  * **Public VNet IP**: `20.10.5.10` (for a web server)
  * **Web Server Internal IP**: `10.0.0.4`
  * **Mail Server Hostname**: `mail.mydomain.com`

-----

## 1\. Creating a DNS Zone

A DNS zone is the prerequisite for adding any records.

### Azure Portal üåê

1.  **Search for "DNS zones"** in the Azure portal search bar and select it.
2.  Click **"+ Create"** or **"Create DNS zone"**.
3.  **Basics Tab**:
      * **Subscription**: Select your Azure subscription.
      * **Resource Group**: Select `rg-dns-demo` (or create new).
      * **Name**: Enter `mydomain.com`.
      * **Region**: (Greyed out for DNS zones as they are global resources, but the resource group will have a region, e.g., `East US`).
4.  **Review + create** and then click **"Create"**.

Once created, note the **Name Servers (NS records)** provided by Azure. These are critical for delegating your domain to Azure DNS. You'll update your domain registrar (e.g., GoDaddy, Namecheap) to point to these four name servers.

### Azure PowerShell üíª

```powershell
# Define variables
$resourceGroupName = "rg-dns-demo"
$zoneName = "mydomain.com"
$location = "eastus" # Location for the resource group

# Create Resource Group if it doesn't exist
New-AzResourceGroup -Name $resourceGroupName -Location $location

# Create the DNS Zone
$dnsZone = New-AzDnsZone -Name $zoneName -ResourceGroupName $resourceGroupName
Write-Host "DNS Zone '$zoneName' created successfully."
Write-Host "Azure Name Servers: $($dnsZone.NameServers)"
```

### Azure CLI üñ•Ô∏è

```bash
# Define variables
resourceGroupName="rg-dns-demo"
zoneName="mydomain.com"
location="eastus" # Location for the resource group

# Create Resource Group if it doesn't exist
az group create --name $resourceGroupName --location $location

# Create the DNS Zone
az network dns zone create --resource-group $resourceGroupName --name $zoneName
echo "DNS Zone '$zoneName' created successfully."

# Get Name Servers for delegation (optional, but useful)
az network dns zone show --resource-group $resourceGroupName --name $zoneName --query 'nameServers'
```

-----

## 2\. Creating DNS Records

Once the zone is created, you can add different types of records.

### General Steps for Adding Records (All Methods):

  * **Record Set Name**: This is the host part of your FQDN (Fully Qualified Domain Name).
      * For `www.mydomain.com`, the record set name is `www`.
      * For `mydomain.com` itself (the "apex" or "root" domain), leave the name blank or use `@`.
  * **TTL (Time-to-Live)**: Specifies how long DNS resolvers should cache the record. A lower TTL means changes propagate faster but result in more queries. Default is usually 3600 seconds (1 hour).

### A Record (Address Record) ‚û°Ô∏è IP Address

An **A record** maps a domain name or hostname to an **IPv4 address**. This is the most common record type for websites and services.

**Example**: Map `www.mydomain.com` to `20.10.5.10` (Public IP of a web server).

#### Azure Portal üåê

1.  Navigate to your `mydomain.com` DNS zone in the portal.
2.  Click **"+ Record set"**.
3.  **Add record set**:
      * **Name**: `www`
      * **Type**: `A`
      * **TTL**: `1` (Hour)
      * **IP address**: `20.10.5.10`
      * Click **"OK"**.

#### Azure PowerShell üíª

```powershell
# Add an A record for www.mydomain.com
Set-AzDnsRecordSet -Name "www" -RecordType "A" `
    -ZoneName $zoneName -ResourceGroupName $resourceGroupName `
    -Ttl 3600 `
    -DnsRecords (New-AzDnsRecordConfig -IPv4Address "20.10.5.10") `
    -Overwrite # Use -Overwrite if re-running and want to replace existing record set
Write-Host "A record for www.mydomain.com created."
```

#### Azure CLI üñ•Ô∏è

```bash
# Add an A record for www.mydomain.com
az network dns record-set a add-record \
    --resource-group $resourceGroupName \
    --zone-name $zoneName \
    --record-set-name "www" \
    --ipv4-address "20.10.5.10" \
    --ttl 3600
echo "A record for www.mydomain.com created."
```

-----

### CNAME Record (Canonical Name Record) ‚û°Ô∏è Another Domain Name

A **CNAME record** creates an alias from one domain name to another canonical domain name. It means `alias.example.com` is really `canonical.example.com`.

**Important**: A CNAME record **cannot** coexist with other record types for the same record set name. Also, you **cannot** create a CNAME record for the root domain (`@` or `mydomain.com`).

**Example**: Map `app.mydomain.com` to `webserver.azurewebsites.net` (an Azure App Service).

#### Azure Portal üåê

1.  Navigate to your `mydomain.com` DNS zone.
2.  Click **"+ Record set"**.
3.  **Add record set**:
      * **Name**: `app`
      * **Type**: `CNAME`
      * **TTL**: `1` (Hour)
      * **Alias name**: `webserver.azurewebsites.net`
      * Click **"OK"**.

#### Azure PowerShell üíª

```powershell
# Add a CNAME record for app.mydomain.com
Set-AzDnsRecordSet -Name "app" -RecordType "CNAME" `
    -ZoneName $zoneName -ResourceGroupName $resourceGroupName `
    -Ttl 3600 `
    -DnsRecords (New-AzDnsRecordConfig -Cname "webserver.azurewebsites.net") `
    -Overwrite
Write-Host "CNAME record for app.mydomain.com created."
```

#### Azure CLI üñ•Ô∏è

```bash
# Add a CNAME record for app.mydomain.com
az network dns record-set cname set-record \
    --resource-group $resourceGroupName \
    --zone-name $zoneName \
    --record-set-name "app" \
    --cname "webserver.azurewebsites.net" \
    --ttl 3600
echo "CNAME record for app.mydomain.com created."
```

-----

### MX Record (Mail Exchanger Record) üìß

An **MX record** specifies the mail server(s) responsible for accepting email messages on behalf of a domain name. It directs email to the correct destination.

**Example**: Direct emails for `mydomain.com` to `mail.mydomain.com` with priority 10.

#### Azure Portal üåê

1.  Navigate to your `mydomain.com` DNS zone.
2.  Click **"+ Record set"**.
3.  **Add record set**:
      * **Name**: `@` (for the root domain)
      * **Type**: `MX`
      * **TTL**: `1` (Hour)
      * **Mail exchanger**:
          * **Preference**: `10` (lower number is higher priority)
          * **Mail exchange server**: `mail.mydomain.com`
      * Click **"OK"**.

#### Azure PowerShell üíª

```powershell
# Add an MX record for mydomain.com (root domain)
Set-AzDnsRecordSet -Name "@" -RecordType "MX" `
    -ZoneName $zoneName -ResourceGroupName $resourceGroupName `
    -Ttl 3600 `
    -DnsRecords (New-AzDnsRecordConfig -Preference 10 -Exchange "mail.mydomain.com") `
    -Overwrite
Write-Host "MX record for mydomain.com created."
```

#### Azure CLI üñ•Ô∏è

```bash
# Add an MX record for mydomain.com (root domain)
az network dns record-set mx add-record \
    --resource-group $resourceGroupName \
    --zone-name $zoneName \
    --record-set-name "@" \
    --preference 10 \
    --exchange "mail.mydomain.com" \
    --ttl 3600
echo "MX record for mydomain.com created."
```

-----

### TXT Record (Text Record) üìù

A **TXT record** holds arbitrary text data. They are commonly used for:

  * **SPF (Sender Policy Framework)**: To prevent email spoofing, specifying which mail servers are authorized to send email on behalf of your domain.
  * **Domain Ownership Verification**: Various services (e.g., Google, Microsoft, domain registrars) use TXT records to verify domain ownership.
  * **DKIM/DMARC**: Email authentication standards.

**Example**: Add an SPF record for `mydomain.com`: `v=spf1 include:_spf.google.com ~all`.

#### Azure Portal üåê

1.  Navigate to your `mydomain.com` DNS zone.
2.  Click **"+ Record set"**.
3.  **Add record set**:
      * **Name**: `@` (for the root domain)
      * **Type**: `TXT`
      * **TTL**: `1` (Hour)
      * **Value**: `"v=spf1 include:_spf.google.com ~all"` (Note the quotes for the value)
      * Click **"OK"**.

#### Azure PowerShell üíª

```powershell
# Add a TXT record for mydomain.com (root domain)
Set-AzDnsRecordSet -Name "@" -RecordType "TXT" `
    -ZoneName $zoneName -ResourceGroupName $resourceGroupName `
    -Ttl 3600 `
    -DnsRecords (New-AzDnsRecordConfig -Value "v=spf1 include:_spf.google.com ~all") `
    -Overwrite
Write-Host "TXT record for mydomain.com created."
```

#### Azure CLI üñ•Ô∏è

```bash
# Add a TXT record for mydomain.com (root domain)
az network dns record-set txt add-record \
    --resource-group $resourceGroupName \
    --zone-name $zoneName \
    --record-set-name "@" \
    --value "v=spf1 include:_spf.google.com ~all" \
    --ttl 3600
echo "TXT record for mydomain.com created."
```

-----

## What to do after creating records: Delegation\! üöÄ

For your public DNS records to actually work, you **must delegate your domain** to Azure DNS. This involves:

1.  Getting the **four Azure-provided name servers** for your DNS zone (you can see these on the Overview page of your DNS zone in the portal, or via PowerShell/CLI commands shown above).
2.  Logging into your **domain registrar's** website (e.g., GoDaddy, Namecheap, Google Domains).
3.  Finding the "Name Servers" or "DNS Settings" section for your domain.
4.  **Replacing** the registrar's default name servers with the four Azure name servers.
5.  Saving the changes.

It can take anywhere from a few minutes to 48 hours for these changes to propagate across the internet (DNS propagation). 

You can use tools like `dig` (Linux/macOS) or `nslookup` (Windows) to query your domain and verify that Azure's name servers are responding.

By following these steps, you can effectively manage your public and private DNS records within Azure, providing reliable name resolution for your applications and services.