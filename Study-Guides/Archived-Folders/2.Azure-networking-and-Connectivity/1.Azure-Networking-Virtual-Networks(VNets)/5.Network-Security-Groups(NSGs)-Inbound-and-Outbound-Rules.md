# Network Security Groups (NSGs) - Inbound and Outbound Rules üõ°Ô∏è

Network Security Groups (NSGs) are a fundamental component of Azure's network security.

They act as a **virtual firewall** that filters network traffic to and from Azure resources in an Azure Virtual Network (VNet). NSGs allow you to define **security rules** that control which types of traffic are permitted or denied based on various criteria.

---

## What are Network Security Groups (NSGs)?

An **NSG** is an Azure resource that contains a list of **security rules** that allow or deny inbound or outbound network traffic. These rules are evaluated based on their priority, and the first rule that matches the traffic is applied. NSGs provide a granular level of control over network access to your Azure resources, such as Virtual Machines (VMs), subnets, and even individual network interfaces.

### Key Characteristics:

* **Virtual Firewall**: NSGs are essentially stateless packet filters that examine IP packets and allow or deny them based on defined rules.
* **Rule-Based**: Security is defined by a set of rules that you configure.
* **Layer 4 Control**: Rules operate at Layer 3 (IP address) and Layer 4 (ports and protocols) of the OSI model.
* **Applied to Subnets or NICs**: NSGs can be associated with an entire subnet, an individual Network Interface Card (NIC) attached to a VM, or both.

---

## Understanding NSG Rules üìú

Each NSG is composed of a collection of **security rules**. Each rule specifies the following properties:

1.  **Name**: A unique name for the rule within the NSG.
2.  **Priority**: A number between 100 and 4096 (lower numbers have higher priority). Rules are processed in order of priority. Once a rule matches the traffic, processing stops.
3.  **Source/Destination**:
    * **IP Addresses/CIDR ranges**: Specific IP addresses, IP address ranges (e.g., `192.168.1.0/24`), or `Any` (`0.0.0.0/0`).
    * **Service Tags**: Azure-defined literal groups of IP addresses for various Azure services (e.g., `VirtualNetwork`, `AzureLoadBalancer`, `Internet`, `Storage`, `Sql`). These tags automatically update, simplifying rule management.
    * **Application Security Groups (ASGs)**: (More advanced) Logical groupings of network interfaces, allowing you to define security rules based on application workload rather than explicit IP addresses.
4.  **Source Port Ranges/Destination Port Ranges**:
    * Specific port numbers (e.g., `80`, `443`, `3389`).
    * Port ranges (e.g., `80-8080`).
    * `*` (Any port).
5.  **Protocol**: `TCP`, `UDP`, `ICMP`, `Any` (`*`).
6.  **Direction**:
    * **Inbound**: Applies to traffic *entering* the associated subnet or NIC.
    * **Outbound**: Applies to traffic *leaving* the associated subnet or NIC.
7.  **Action**:
    * **Allow**: Permits the traffic.
    * **Deny**: Blocks the traffic.

### How Rules Are Processed:

NSG rules are processed based on their **priority** in ascending order (lowest number first).
* If a rule for **inbound traffic** matches, and it has a higher priority (lower number) than any other matching rules, that rule is applied, and no further rules are processed for that traffic.
* The same logic applies to **outbound traffic**.

This means that a low-priority rule (high number) will only be evaluated if no higher-priority rule matches the traffic.

---

## Inbound Rules (Ingress) ‚û°Ô∏è

**Inbound rules** control traffic *coming into* your Azure resources. They define what external entities (or other resources within your VNet) are allowed to initiate connections to your VMs or services.

### Common Use Cases for Inbound Rules:

* **Allowing RDP/SSH Access**:
    * **Source**: Your public IP address (for secure admin access) or a specific IP range.
    * **Source Port**: `*` (any)
    * **Destination**: The private IP of your VM or the subnet range.
    * **Destination Port**: `3389` (RDP) or `22` (SSH).
    * **Protocol**: `TCP`.
    * **Action**: `Allow`.
* **Allowing Web Traffic**:
    * **Source**: `Internet` (Service Tag) or `Any` (`0.0.0.0/0`).
    * **Source Port**: `*`.
    * **Destination**: The private IP of your web server VM or the subnet range.
    * **Destination Port**: `80` (HTTP), `443` (HTTPS).
    * **Protocol**: `TCP`.
    * **Action**: `Allow`.
* **Allowing Internal Application Traffic**:
    * **Source**: `VirtualNetwork` (Service Tag) or a specific subnet CIDR (e.g., `10.1.0.0/24`).
    * **Source Port**: `*`.
    * **Destination**: The private IP of your application server or the subnet range.
    * **Destination Port**: Specific application port (e.g., `8080`).
    * **Protocol**: `TCP`.
    * **Action**: `Allow`.

---

## Outbound Rules (Egress) ‚¨ÖÔ∏è

**Outbound rules** control traffic *leaving* your Azure resources. They define what your VMs or services are allowed to connect to outside their current network segment.

### Common Use Cases for Outbound Rules:

* **Allowing Internet Access (e.g., for Windows Updates, software downloads)**:
    * **Source**: The private IP of your VM or the subnet range.
    * **Source Port**: `*`.
    * **Destination**: `Internet` (Service Tag) or `Any` (`0.0.0.0/0`).
    * **Destination Port**: `80`, `443`.
    * **Protocol**: `TCP`.
    * **Action**: `Allow`.
* **Allowing Database Connectivity**:
    * **Source**: The private IP of your application server or its subnet range.
    * **Source Port**: `*`.
    * **Destination**: The private IP of your database server or its subnet range.
    * **Destination Port**: `1433` (SQL Server), `3306` (MySQL), etc.
    * **Protocol**: `TCP`.
    * **Action**: `Allow`.
* **Denying Unwanted Outbound Traffic**:
    * **Source**: `*`.
    * **Destination**: `Internet` (Service Tag) or `Any` (`0.0.0.0/0`).
    * **Destination Port**: `*`.
    * **Protocol**: `Any`.
    * **Action**: `Deny`. (Placed at a lower priority than specific "Allow" rules).

---

By carefully crafting inbound and outbound rules, you can establish strong network security boundaries around your Azure resources. The key is to apply the principle of **least privilege**, allowing only the necessary traffic and explicitly denying everything else.