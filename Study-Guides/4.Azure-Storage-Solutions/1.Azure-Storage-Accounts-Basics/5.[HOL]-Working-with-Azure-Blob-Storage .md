# Lab: Working with Azure Blob Storage 💾

## Lab Scenario 🌐

You have a storage account provisioned (from Lab 1) and now need to use its Blob Storage capabilities. Your task is to:

1.  Create a container for storing application logs.
2.  Create a simple text file locally.
3.  Upload this text file as a block blob to the container.
4.  View the uploaded blob in the Azure Portal.
5.  Download the blob.
6.  List all blobs in the container.
7.  Delete the blob and the container.

**Resources you'll be interacting with:**

  * **Existing Resource Group**: `rg-storage-lab`
  * **Existing Storage Account**: `storagenameyouruniqueid` (from Lab 1)

-----

## Part 1: Prerequisites

  * An active Azure subscription.
  * The Azure Storage Account created in **Day 21 Lab 1** (e.g., `storagenameyouruniqueid` within `rg-storage-lab`).
  * Azure Portal access OR Azure CLI / Azure PowerShell installed and configured.
  * **For Azure CLI/PowerShell**: Ensure you are logged into your Azure account.

-----

## Part 2: Create a Local Test File

Before we upload anything, let's create a simple text file on your local machine.

1.  **Open a text editor** (e.g., Notepad on Windows, TextEdit on macOS, VS Code).
2.  **Enter some text** into the file. For example:
    ```
    This is a test log entry for my Azure Blob Storage lab.
    Timestamp: 2025-07-24 10:30:00
    Event: Application startup
    ```
3.  **Save the file** as `applog.txt` in a convenient location (e.g., your Desktop or a `C:\temp` folder). Remember this path.

-----

## Part 3: Create a Blob Container

Blobs reside in containers. We'll create a container named `applogs`.

**(Choose one method: Azure Portal, Azure CLI, or Azure PowerShell)**

**3.1. Azure Portal Method**

1.  Sign in to the [Azure Portal](https://portal.azure.com/).
2.  Navigate to your Storage Account (either search for it, or go to `Resource groups` -\> `rg-storage-lab` -\> your storage account).
3.  In the left menu of the storage account, under **Data storage**, select **Containers**.
4.  Click **+ Container**.
5.  **Name**: Enter `applogs`.
6.  **Public access level**: Select `Private (no anonymous access)`. (This is the most secure option and generally recommended unless you specifically need public access).
7.  Click **Create**.
8.  You should now see `applogs` listed in your containers.

**3.2. Azure CLI Method**

1.  Open your terminal or Cloud Shell.
2.  Replace `storagenameyouruniqueid` with your actual storage account name.
3.  Create the container:
    ```bash
    az storage container create \
      --name applogs \
      --account-name storagenameyouruniqueid \
      --public-access off
    ```
4.  You should see output indicating success, e.g., `{"created": true}`.

**3.3. Azure PowerShell Method**

1.  Open PowerShell.
2.  First, get the context of your storage account. Replace `storagenameyouruniqueid` and `rg-storage-lab` with your actual names.
    ```powershell
    $storageAccountName = "storagenameyouruniqueid"
    $resourceGroupName = "rg-storage-lab"
    $ctx = (Get-AzStorageAccount -ResourceGroupName $resourceGroupName -Name $storageAccountName).Context
    ```
3.  Create the container:
    ```powershell
    New-AzStorageContainer -Name "applogs" -Context $ctx -Permission Off
    ```
4.  You should see an object representing the newly created container.

-----

## Part 4: Upload the Blob

Now, let's upload your `applog.txt` file as a block blob.

**(Choose one method: Azure Portal, Azure CLI, or Azure PowerShell)**

**4.1. Azure Portal Method**

1.  In the Azure Portal, navigate to your storage account -\> **Containers**.
2.  Click on the `applogs` container.
3.  Click the **Upload** button.
4.  In the "Upload blob" blade:
      * Click the folder icon next to "Files" to browse your local file system.
      * Select your `applog.txt` file.
      * (Optional) Expand **Advanced** to see options like Access Tier. Leave it at "Hot" for now.
5.  Click **Upload**.
6.  You should now see `applog.txt` listed within the `applogs` container.

**4.2. Azure CLI Method**

1.  Open your terminal or Cloud Shell.

2.  Replace `storagenameyouruniqueid` with your actual storage account name.

3.  Replace `C:\Path\To\applog.txt` with the actual path to your local file.

4.  Upload the blob:

    ```bash
    az storage blob upload \
      --container-name applogs \
      --file "C:\Path\To\applog.txt" \
      --name applog.txt \
      --account-name storagenameyouruniqueid \
      --type BlockBlob \
      --overwrite true
    ```

      * `--type BlockBlob`: Explicitly specifies it's a block blob.
      * `--overwrite true`: Allows overwriting if a blob with the same name already exists.

5.  You should see JSON output confirming the upload.

**4.3. Azure PowerShell Method**

1.  Open PowerShell.
2.  Ensure `$ctx` is set from Part 3.3.
3.  Replace `C:\Path\To\applog.txt` with the actual path to your local file.
4.  Upload the blob:
    ```powershell
    Set-AzStorageBlobContent -Container "applogs" `
      -File "C:\Path\To\applog.txt" `
      -Blob "applog.txt" `
      -Context $ctx `
      -BlobType Block `
      -Force # Use -Force to overwrite if exists
    ```
5.  You should see an object representing the uploaded blob.

-----

## Part 5: View and Download the Blob

Let's confirm the blob is there and download it.

**(Choose one method: Azure Portal, Azure CLI, or Azure PowerShell)**

**5.1. Azure Portal Method (View & Download)**

1.  In the Azure Portal, navigate to your storage account -\> **Containers** -\> `applogs`.
2.  Click on `applog.txt`.
3.  You'll see its properties. To view content, you might need to click "Edit" or "Download" and open it.
4.  Click the **Download** button to save a copy of the blob to your local machine.

**5.2. Azure CLI Method (List Blobs & Download)**

1.  Open your terminal or Cloud Shell.
2.  **List blobs**:
    ```bash
    az storage blob list \
      --container-name applogs \
      --account-name storagenameyouruniqueid \
      --query "[].name" # To list just the names
    ```
    You should see `["applog.txt"]` in the output.
3.  **Download blob**: Replace `C:\DownloadPath\applog_downloaded.txt` with your desired local download path.
    ```bash
    az storage blob download \
      --container-name applogs \
      --name applog.txt \
      --file "C:\DownloadPath\applog_downloaded.txt" \
      --account-name storagenameyouruniqueid
    ```
4.  Verify the file content on your local machine.

**5.3. Azure PowerShell Method (List Blobs & Download)**

1.  Open PowerShell.
2.  Ensure `$ctx` is set from Part 3.3.
3.  **List blobs**:
    ```powershell
    Get-AzStorageBlob -Container "applogs" -Context $ctx | Select-Object Name, Length, LastModified
    ```
    You should see details for `applog.txt`.
4.  **Download blob**: Replace `C:\DownloadPath\applog_downloaded.txt` with your desired local download path.
    ```powershell
    Get-AzStorageBlobContent -Container "applogs" `
      -Blob "applog.txt" `
      -Destination "C:\DownloadPath\applog_downloaded.txt" `
      -Context $ctx `
      -Force # Overwrite if file exists
    ```
5.  Verify the file content on your local machine.

-----

## Part 6: Clean Up Blob and Container

It's good practice to clean up resources you no longer need.

**(Choose one method: Azure Portal, Azure CLI, or Azure PowerShell)**

**6.1. Azure Portal Method**

1.  In the Azure Portal, navigate to your storage account -\> **Containers**.
2.  Click on the `applogs` container.
3.  Select the `applog.txt` blob by checking its checkbox.
4.  Click **Delete**. Confirm the deletion.
5.  Go back to the **Containers** list.
6.  Select the `applogs` container by checking its checkbox.
7.  Click **Delete**. Confirm the deletion.

**6.2. Azure CLI Method**

1.  Open your terminal or Cloud Shell.
2.  Delete the blob:
    ```bash
    az storage blob delete \
      --container-name applogs \
      --name applog.txt \
      --account-name storagenameyouruniqueid
    ```
3.  Delete the container:
    ```bash
    az storage container delete \
      --name applogs \
      --account-name storagenameyouruniqueid
    ```

**6.3. Azure PowerShell Method**

1.  Open PowerShell.
2.  Ensure `$ctx` is set from Part 3.3.
3.  Delete the blob:
    ```powershell
    Remove-AzStorageBlob -Container "applogs" -Blob "applog.txt" -Context $ctx -Force
    ```
4.  Delete the container:
    ```powershell
    Remove-AzStorageContainer -Name "applogs" -Context $ctx -Force
    ```

-----

## Part 7: Final Cleanup (Delete the Resource Group)

If you have completed both labs for Day 21 and no longer need the storage account, you can delete the entire resource group. This will remove the storage account and all its contents.

**(Choose one method)**

**7.1. Azure Portal**

1.  Go to **Resource groups**.
2.  Select `rg-storage-lab`.
3.  Click **Delete resource group**, type the name to confirm, and click **Delete**.

**7.2. Azure CLI**

```bash
az group delete --name rg-storage-lab --no-wait --yes
```

**7.3. Azure PowerShell**

```powershell
Remove-AzResourceGroup -Name "rg-storage-lab" -Force
```

-----

Congratulations\! You have successfully created a blob container, uploaded a blob, managed it, and cleaned up your resources. 

You now have practical experience with Azure Blob Storage, a crucial component of many cloud applications.